<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³•æœµå…§è¤²å°ºå¯¸æŒ‘é¸æ”»ç•¥</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #fdf2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: #444;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
            position: relative;
            min-height: 550px; /* ç¨å¾®åŠ é«˜ä»¥å®¹ç´é€²åº¦æ¢ */
            display: flex;
            flex-direction: column;
        }
        
        /* --- é€²åº¦æ¢æ¨£å¼ (æ–°åŠŸèƒ½) --- */
        .progress-container {
            display: none; /* é è¨­éš±è—ï¼Œæ­¡è¿é ä¸é¡¯ç¤º */
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        .progress-line-bg {
            position: absolute;
            top: 15px;
            left: 35px;
            right: 35px;
            height: 3px;
            background-color: #eee;
            z-index: 0;
        }
        .progress-line-fill {
            position: absolute;
            top: 15px;
            left: 35px;
            height: 3px;
            background-color: #d67d7d;
            z-index: 0;
            width: 0%; /* å‹•æ…‹æ§åˆ¶ */
            transition: width 0.4s ease;
        }
        .step-circle-wrapper {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #eee;
            color: #999;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.4s;
        }
        .step-circle.active {
            background-color: #d67d7d;
            color: white;
            box-shadow: 0 0 0 4px #fdf2f5; /* å¤–å…‰æšˆæ•ˆæœ */
        }
        .step-label {
            font-size: 12px;
            color: #999;
            margin-top: 6px;
        }
        .step-circle.active + .step-label {
            color: #d67d7d;
            font-weight: bold;
        }

        /* --- ä¸€èˆ¬æ¨£å¼ --- */
        h2 {
            color: #d67d7d;
            text-align: center;
            margin-bottom: 20px;
            font-size: 22px;
        }
        .welcome-title {
            font-size: 26px;
            color: #d67d7d;
            margin-bottom: 30px;
            line-height: 1.4;
        }
        
        .step {
            display: none;
            flex-grow: 1;
            flex-direction: column;
        }
        .step.active {
            display: flex;
            animation: fadeIn 0.5s;
        }
        
        #welcome-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
            text-align: left;
            width: 100%;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        /* æŒ‰éˆ•èˆ‡å…¶ä»–å…ƒä»¶ä¿æŒåŸæ¨£ */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            width: 100%;
        }
        .btn-group button {
            flex: 1;
        }
        button {
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        button.primary-btn {
            width: 100%;
            padding: 14px;
            background-color: #d67d7d;
            color: white;
            font-size: 18px;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(214, 125, 125, 0.2);
        }
        button.primary-btn:hover {
            background-color: #c06060;
            transform: translateY(-1px);
        }
        button.secondary-btn {
            width: 100%;
            padding: 12px;
            background-color: #f0f0f0;
            color: #666;
            font-size: 14px;
        }
        button.outline-btn {
            width: 100%;
            padding: 12px;
            background-color: white;
            color: #d67d7d;
            border: 2px solid #d67d7d;
            font-size: 16px;
            margin-bottom: 10px;
        }
        button.copy-btn {
            background: transparent;
            border: 1px solid #ddd;
            color: #888;
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 20px;
            margin-top: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
        }
        button.copy-btn:hover {
            background: #f9f9f9;
            color: #555;
        }
        button.line-btn {
            width: 100%;
            padding: 14px;
            background-color: #06c755;
            color: white;
            font-size: 16px;
            margin-top: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(6, 199, 85, 0.2);
        }
        button.line-btn:hover {
            background-color: #05b34c;
        }

        .pref-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        .pref-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            background: white;
            color: #666;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        .pref-btn.selected {
            border-color: #d67d7d;
            background-color: #fff0f0;
            color: #d67d7d;
            font-weight: bold;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }
        .menu-item {
            padding: 15px 5px;
            background: #fff8f8;
            border: 1px solid #f0d0d0;
            border-radius: 10px;
            text-align: center;
            color: #d67d7d;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .menu-item:hover {
            background: #d67d7d;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(214, 125, 125, 0.3);
        }
        .menu-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .info-box {
            background-color: #fff8f8;
            border-left: 4px solid #d67d7d;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #666;
            line-height: 1.6;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
        }
        .care-box {
            background-color: #f4f4f4;
            color: #666;
            font-size: 12px;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            margin-bottom: 15px;
            line-height: 1.5;
            width: 100%;
            box-sizing: border-box;
        }
        .welcome-note {
            font-size: 13px;
            color: #888;
            line-height: 1.6;
            margin-top: 30px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 10px;
            text-align: left;
        }
        .result-box {
            text-align: center;
            padding: 20px 10px;
            border: 2px dashed #d67d7d;
            border-radius: 15px;
            margin-top: 0;
            margin-bottom: 15px;
            position: relative;
            width: 100%;
            box-sizing: border-box;
        }
        .result-size {
            font-size: 48px;
            color: #d67d7d;
            font-weight: bold;
            margin: 5px 0;
            line-height: 1;
        }
        .tag {
            display: inline-block;
            background: #eee;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 5px;
            color: #555;
        }
        .note {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
            text-align: center;
        }
        .footer-note {
            margin-top: auto;
            padding-top: 20px;
            text-align: center;
            font-size: 12px;
            color: #aaa;
            border-top: 1px solid #eee;
            width: 100%;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #toast {
            visibility: hidden;
            min-width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 25px;
            padding: 10px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
        }
        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }
        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }
        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="progress-container" id="progressBar">
        <div class="progress-line-bg"></div>
        <div class="progress-line-fill" id="progressLine"></div>
        
        <div class="step-circle-wrapper">
            <div class="step-circle" id="circle1">1</div>
            <div class="step-label">åŸºæœ¬è³‡æ–™</div>
        </div>
        <div class="step-circle-wrapper">
            <div class="step-circle" id="circle2">2</div>
            <div class="step-label">èº«å½¢æ¸¬é‡</div>
        </div>
        <div class="step-circle-wrapper">
            <div class="step-circle" id="circle3">3</div>
            <div class="step-label">å»ºè­°å°ºå¯¸</div>
        </div>
    </div>

    <div id="welcome-screen" class="step active">
        <div class="welcome-title">
            æ­¡è¿ä½¿ç”¨<br>
            <b>æ³•æœµå…§è¤²å°ºå¯¸æ¸¬é‡æ”»ç•¥</b>
        </div>
        
        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ“</div>

        <button class="primary-btn" onclick="startApp()">é–‹å§‹æ¸¬é‡</button>

        <div class="welcome-note">
            ğŸ’¡ <strong>å°æç¤ºï¼š</strong><br>
            æ¯å€‹äººèº«é«˜é«”é‡å’Œå•†å“å°ºå¯¸ä¸ç›¡ç›¸åŒã€‚<br>
            èº«é«˜150cmè±è…´èˆ‡175cmç˜¦é«˜çš„å¥³å­©ï¼Œæœ‰å¯èƒ½é¸æ“‡åŒæ¨£å°ºå¯¸çš„å•†å“ã€‚<br>
            æ­¤æ¸¬é‡çµæœåƒ…ä¾›åƒè€ƒã€‚
        </div>
    </div>

    <div id="step1" class="step">
        <h2 id="mainTitle">è¼¸å…¥åŸºæœ¬è³‡æ–™</h2>
        <label>æ‚¨çš„èº«é«˜ (cm)</label>
        <input type="number" id="height" placeholder="ä¾‹å¦‚ï¼š160">
        
        <label>æ‚¨çš„é«”é‡ (kg)</label>
        <input type="number" id="weight" placeholder="ä¾‹å¦‚ï¼š55">
        
        <button class="primary-btn" onclick="nextStep(1)">ä¸‹ä¸€æ­¥</button>
    </div>

    <div id="step2" class="step">
        <h2 id="mainTitle">èº«å½¢èˆ‡åå¥½</h2>
        <div class="info-box">
            <strong>ğŸ’¡ è‡€åœæ¸¬é‡æ–¹æ³•ï¼š</strong><br>
            æ‹¿å‡ºçš®å°ºæ¸¬é‡è‡€éƒ¨æœ€å¯¬çš„éƒ¨åˆ†ã€‚<br>
            å¦‚æ²’æœ‰çš®å°ºä¹Ÿå¯ä»¥ç”¨ç¹©å­æ¸¬é‡ç´€éŒ„ï¼Œå†ç”¨ç›´å°ºæ¸¬é‡é•·åº¦å³å¯ã€‚
        </div>

        <label>æ‚¨çš„è‡€åœ (cm)</label>
        <input type="number" id="hip" placeholder="è¼¸å…¥è‡€åœå…¬åˆ†æ•¸ (è‹¥ä¸çŸ¥é“å¯ç•™ç©º)">

        <label>æ‚¨å–œæ­¡çš„ç©¿è‘—æ„Ÿå—ï¼Ÿ(å¿…é¸)</label>
        <div class="pref-container">
            <div class="pref-btn" id="pref-tight" onclick="selectPref('tight')">
                è²¼èº«åŒ…è¦†<br><span style="font-size:12px">(å–œæ­¡å‰›å¥½)</span>
            </div>
            <div class="pref-btn" id="pref-loose" onclick="selectPref('loose')">
                èˆ’é©å¯¬é¬†<br><span style="font-size:12px">(ä¸æ„›å‹’ç—•)</span>
            </div>
        </div>

        <button class="primary-btn" onclick="calculateSize(true)">è¼¸å…¥å¥½è‡€åœäº†ï¼Œè¨ˆç®—å°ºå¯¸</button>
        <button class="secondary-btn" onclick="calculateSize(false)">ä¸çŸ¥é“è‡€åœ (åƒ…ç”¨èº«é«˜é«”é‡æ¨ç®—)</button>
        <div class="note">âš ï¸ æé†’æ‚¨ï¼šè‡€åœæ•¸æ“šæœƒæ¯”èº«é«˜é«”é‡æ›´æº–ç¢ºå–”ï¼</div>
    </div>

    <div id="result" class="step">
        <h2 id="mainTitle">æ‚¨çš„å»ºè­°å°ºå¯¸</h2>
        <div class="result-box">
            <div class="tag" id="prefTag"></div>
            <div>æ ¹æ“šæ•¸æ“šï¼Œå»ºè­°å°ºå¯¸ç‚º</div>
            <div class="result-size" id="recommendedSize">L</div>
            <div id="resultDetail" style="color: #666; font-size: 13px; margin-bottom: 8px;"></div>
            <button class="copy-btn" onclick="copyResult()">
                ğŸ“‹ è¤‡è£½æˆ‘çš„å°ºå¯¸å°å¡
            </button>
        </div>
        
        <div class="info-box" id="fittingNote" style="margin-bottom: 10px;"></div>

        <button class="primary-btn" onclick="showRecommendations()">ç¹¼çºŒæ¨è–¦åˆé©ç”¢å“</button>
        
        <button class="line-btn" onclick="window.open('https://lin.ee/4WoBo0r', '_blank')">
            ğŸ’¬ æœ‰ç–‘å•ï¼ŸåŠ å…¥ LINE å®¢æœè«®è©¢
        </button>

        <button class="secondary-btn" onclick="finishSession()">åˆ°æ­¤ç‚ºæ­¢</button>

        <div class="care-box">
            å°æé†’ï¼šå…§è¤²å»ºè­°ä½¿ç”¨å†·æ°´æ‰‹æ´—ï¼Œ<br>
            è‹¥è¦æ©Ÿæ´—è«‹å‹™å¿…ä½¿ç”¨æ´—è¡£è¢‹ï¼Œæ‰èƒ½å»¶é•·å£½å‘½å–”ï¼
        </div>
    </div>

    <div id="promo-main" class="step">
        <h2 id="mainTitle">ç‚ºæ‚¨æ¨è–¦</h2>
        <label style="text-align:center; font-size:18px;">è«‹å•æ‚¨æƒ³æ‰¾å“ªç¨®é¡å‹çš„å…§è¤²ï¼Ÿ</label>
        <div class="menu-grid">
            <div class="menu-item" onclick="showSubCategory('shape')">
                <div class="menu-icon">ğŸ’ƒ</div>
                èº«å½¢ä¿®é£¾
            </div>
            <div class="menu-item" onclick="showSubCategory('material')">
                <div class="menu-icon">ğŸƒ</div>
                ä»¥æè³ªå€åˆ†
            </div>
            <div class="menu-item" onclick="showSubCategory('cut')">
                <div class="menu-icon">âœ‚ï¸</div>
                ä»¥ç‰ˆå‹å€åˆ†
            </div>
            <div class="menu-item" onclick="showSubCategory('habit')">
                <div class="menu-icon">â¤ï¸</div>
                è§£æ±ºå›°æ“¾
            </div>
             <div class="menu-item" style="grid-column: span 2;" onclick="goToLink('https://www.faduobra.com/v2/official/SalePageCategory/514005?sortMode=Curator')">
                <div class="menu-icon">ğŸŒ¸</div>
                æ£‰èŠ±ç³–å¥³å­©å°ˆå€
            </div>
        </div>
        <br>
        <button class="secondary-btn" onclick="backToResult()">å›ä¸Šä¸€é </button>
    </div>

    <div id="promo-sub" class="step">
        <h2 id="mainTitle">å•†å“åˆ†é¡</h2>
        <label id="subTitle" style="text-align:center; font-size:18px; margin-bottom:15px;"></label>
        <div id="subButtonsContainer"></div>
        <br>
        <button class="secondary-btn" onclick="showRecommendations()">å›åˆ†é¡é¸å–®</button>
    </div>

    <div id="end-screen" class="step" style="text-align: center;">
        <h3 style="color:#d67d7d; margin-top:20px;">æ„Ÿè¬æ‚¨çš„ä½¿ç”¨ï¼</h3>
        <p>å¸Œæœ›æ‚¨èƒ½æ‰¾åˆ°æœ€èˆ’é©çš„å…§è¤²ã€‚</p>
        <div class="care-box">
            å°æé†’ï¼šå…§è¤²å»ºè­°ä½¿ç”¨å†·æ°´æ‰‹æ´—ï¼Œ<br>
            è‹¥è¦æ©Ÿæ´—è«‹å‹™å¿…ä½¿ç”¨æ´—è¡£è¢‹ï¼Œæ‰èƒ½å»¶é•·å£½å‘½å–”ï¼
        </div>
        <br>
        <button class="line-btn" onclick="window.open('https://lin.ee/4WoBo0r', '_blank')">
            ğŸ’¬ åŠ å…¥ LINE å¥½å‹
        </button>
        <button class="outline-btn" onclick="location.reload()">é‡æ–°æ¸¬é‡</button>
    </div>

    <div class="footer-note">
        ç‚ºäº†ç§å¯†è™•å¥åº·ï¼Œå»ºè­°æ¯ 3-6 å€‹æœˆéœ€æ›¿æ›å…§è¤²
    </div>
</div>

<div id="toast">å·²è¤‡è£½å°ºå¯¸è³‡è¨Šï¼</div>

<script>
    // ç”¢å“é€£çµè³‡æ–™åº«
    const productLinks = {
        shape: [
            { name: "ğŸ¤° æˆ‘æœ‰å°è…¹ (æ”¶è…¹æ¬¾)", url: "https://www.faduobra.com/SalePage/Index/10028317" },
            { name: "ğŸ‘ æˆ‘æœ‰é¦¬éè‚‰ (ä¿®é£¾æ¬¾)", url: "https://www.faduobra.com/SalePage/Index/11098260" }
        ],
        material: [
            { name: "ğŸƒ æ¶¼çˆ½é€æ°£", url: "https://www.faduobra.com/v2/official/SalePageCategory/520439?sortMode=Curator" },
            { name: "ğŸ›¡ï¸ å®‰é‹…æŠ—èŒ", url: "https://www.faduobra.com/v2/official/SalePageCategory/491112" },
            { name: "âœ¨ ç„¡ç—•ç³»åˆ—", url: "https://www.faduobra.com/v2/official/SalePageCategory/491114" }
        ],
        cut: [
            { name: "ä½è…°ç‰ˆå‹", url: "https://www.faduobra.com/v2/official/SalePageCategory/491117" },
            { name: "ä¸­è…°ç‰ˆå‹", url: "https://www.faduobra.com/v2/official/SalePageCategory/491118" },
            { name: "é«˜è…°ç‰ˆå‹", url: "https://www.faduobra.com/v2/official/SalePageCategory/491119?sortMode=Sales" }
        ],
        habit: [
            { name: "ğŸ’¨ æƒ³æ”¹å–„æ‚¶ç†±å•é¡Œ", url: "https://www.faduobra.com/v2/official/SalePageCategory/520439" },
            { name: "ğŸ©º æƒ³æ”¹å–„å©¦ç§‘å•é¡Œ", url: "https://www.faduobra.com/v2/official/SalePageCategory/542708?sortMode=Sales" },
            { name: "ğŸ æƒ³è²·çµ¦åª½åª½ç©¿", url: "https://www.faduobra.com/v2/official/SalePageCategory/512365?sortMode=Curator" },
            { name: "â˜ï¸ æƒ³æ”¹å–„æ‘©æ“¦ç•°ç‰©æ„Ÿ", url: "https://www.faduobra.com/v2/official/SalePageCategory/512377?sortMode=Curator" }
        ]
    };

    let userData = {
        height: 0,
        weight: 0,
        hip: 0,
        preference: '',
        finalSize: ''
    };

    // --- é€²åº¦æ¢æ§åˆ¶å‡½å¼ ---
    function updateProgressBar(step) {
        const barContainer = document.getElementById('progressBar');
        const line = document.getElementById('progressLine');
        const c1 = document.getElementById('circle1');
        const c2 = document.getElementById('circle2');
        const c3 = document.getElementById('circle3');

        // é è¨­å…¨éƒ¨é‡ç½®
        c1.classList.remove('active');
        c2.classList.remove('active');
        c3.classList.remove('active');
        
        if (step === 0) { // Welcome or Promo
            barContainer.style.display = 'none';
        } else {
            barContainer.style.display = 'flex';
        }

        if (step === 1) { // èº«é«˜é«”é‡
            c1.classList.add('active');
            line.style.width = '0%';
        } else if (step === 2) { // è‡€åœåå¥½
            c1.classList.add('active');
            c2.classList.add('active');
            line.style.width = '50%';
        } else if (step === 3) { // çµæœé 
            c1.classList.add('active');
            c2.classList.add('active');
            c3.classList.add('active');
            line.style.width = '100%';
        }
    }

    function startApp() {
        switchStep('welcome-screen', 'step1');
        updateProgressBar(1);
    }

    function nextStep(currentStep) {
        if (currentStep === 1) {
            const h = document.getElementById('height').value;
            const w = document.getElementById('weight').value;
            if (!h || !w) {
                alert("è«‹è¼¸å…¥èº«é«˜èˆ‡é«”é‡ä»¥åˆ©è¨ˆç®—ï¼");
                return;
            }
            userData.height = parseInt(h);
            userData.weight = parseInt(w);
            switchStep('step1', 'step2');
            updateProgressBar(2);
        }
    }

    function switchStep(from, to) {
        document.getElementById(from).classList.remove('active');
        document.getElementById(to).classList.add('active');
    }

    function selectPref(type) {
        userData.preference = type;
        document.getElementById('pref-tight').classList.remove('selected');
        document.getElementById('pref-loose').classList.remove('selected');
        document.getElementById('pref-' + type).classList.add('selected');
    }

    function calculateSize(hasHipData) {
        if (!userData.preference) {
            alert("è«‹å…ˆé¸æ“‡æ‚¨å–œæ­¡ã€Œè²¼èº«åŒ…è¦†ã€é‚„æ˜¯ã€Œèˆ’é©å¯¬é¬†ã€çš„ç©¿è‘—æ„Ÿå—å–”ï¼");
            return;
        }

        let finalSize = '';
        let message = '';
        let note = '';
        const prefText = userData.preference === 'tight' ? 'å–œæ­¡åˆèº«' : 'å–œæ­¡å¯¬é¬†';
        document.getElementById('prefTag').innerText = `åå¥½ï¼š${prefText}`;

        if (hasHipData) {
            const hip = parseInt(document.getElementById('hip').value);
            if (!hip) {
                alert("è«‹è¼¸å…¥è‡€åœæ•¸å­—");
                return;
            }
            userData.hip = hip;

            // è‡€åœé‚è¼¯
            if (hip < 91) {
                finalSize = 'M';
                note = 'ä¾æ“šè‡€åœï¼ŒM è™Ÿå°æ‚¨ä¾†èªªæ˜¯æ¨™æº–åˆé©çš„å°ºå¯¸ã€‚';
            } else if (hip >= 91 && hip <= 93) {
                finalSize = (userData.preference === 'tight') ? 'M' : 'L';
                note = `æ•¸æ“šä»‹æ–¼ M/L ä¹‹é–“ï¼Œä¾ç…§æ‚¨${prefText}çš„å–œå¥½å»ºè­°é¸æ“‡ ${finalSize}ã€‚`;
            } else if (hip > 93 && hip < 97) {
                finalSize = 'L';
                note = 'ä¾æ“šè‡€åœï¼ŒL è™Ÿæ˜¯æ‚¨çš„æœ€ä½³é¸æ“‡ã€‚';
            } else if (hip >= 97 && hip <= 99) {
                finalSize = (userData.preference === 'tight') ? 'L' : 'XL';
                note = `æ•¸æ“šä»‹æ–¼ L/XL ä¹‹é–“ï¼Œä¾ç…§æ‚¨${prefText}çš„å–œå¥½å»ºè­°é¸æ“‡ ${finalSize}ã€‚`;
            } else if (hip > 99 && hip < 104) {
                finalSize = 'XL';
                note = 'XL è™Ÿçš„å½ˆæ€§ç¯„åœéå¸¸é©åˆæ‚¨çš„èº«å½¢ã€‚';
            } else if (hip >= 104 && hip <= 106) {
                finalSize = (userData.preference === 'tight') ? 'XL' : 'XXL';
                note = `æ•¸æ“šä»‹æ–¼ XL/XXL ä¹‹é–“ï¼Œä¾ç…§æ‚¨${prefText}çš„å–œå¥½å»ºè­°é¸æ“‡ ${finalSize}ã€‚`;
            } else if (hip > 106 && hip < 114) {
                finalSize = 'XXL';
                note = 'XXL è™Ÿèƒ½æä¾›æ‚¨è¶³å¤ çš„åŒ…è¦†èˆ‡èˆ’é©åº¦ã€‚';
            } else if (hip >= 114 && hip <= 116) {
                finalSize = (userData.preference === 'tight') ? 'XXL' : 'XXXL';
                note = `æ•¸æ“šä»‹æ–¼ XXL/3XL ä¹‹é–“ï¼Œä¾ç…§æ‚¨${prefText}çš„å–œå¥½å»ºè­°é¸æ“‡ ${finalSize}ã€‚`;
            } else {
                finalSize = 'XXXL';
                note = '3XL è™Ÿçš„å¤§å½ˆæ€§èˆ‡ç©ºé–“éå¸¸é©åˆæ‚¨ã€‚';
            }
            message = `ä¾æ“šè‡€åœ (${hip}cm) èˆ‡å–œå¥½åˆ¤æ–·`;

        } else {
            // é«”é‡é‚è¼¯
            const w = userData.weight;
            if (w < 52) finalSize = 'M';
            else if (w >= 52 && w <= 55) finalSize = (userData.preference === 'tight') ? 'M' : 'L';
            else if (w > 55 && w < 62) finalSize = 'L';
            else if (w >= 62 && w <= 65) finalSize = (userData.preference === 'tight') ? 'L' : 'XL';
            else if (w > 65 && w < 72) finalSize = 'XL';
            else if (w >= 72 && w <= 75) finalSize = (userData.preference === 'tight') ? 'XL' : 'XXL';
            else if (w > 75 && w < 82) finalSize = 'XXL';
            else if (w >= 82 && w <= 85) finalSize = (userData.preference === 'tight') ? 'XXL' : 'XXXL';
            else finalSize = 'XXXL';

            message = `ä¾æ“šé«”é‡æ¨ç®— (å»ºè­°æ¸¬é‡è‡€åœæ›´æº–ç¢º)`;
            
            if (['52', '53', '54', '55', '62', '63', '64', '65', '72', '73', '74', '75'].includes(w.toString())) {
                note = `é«”é‡è™•æ–¼å°ºå¯¸äº¤ç•Œï¼Œå·²ä¾æ“šæ‚¨ã€Œ${prefText}ã€çš„è¨­å®šæŒ‘é¸ã€‚`;
            } else {
                note = `ç³»çµ±ä¾æ“šæ‚¨çš„é«”é‡ (${w}kg) è©•ä¼°ã€‚è‹¥æ‚¨ä¸‹åŠèº«è¼ƒè±è…´ï¼Œå»ºè­°åƒè€ƒè‡€åœã€‚`;
            }
        }

        userData.finalSize = finalSize;

        switchStep('step2', 'result');
        document.getElementById('recommendedSize').innerText = finalSize;
        document.getElementById('resultDetail').innerText = message;
        document.getElementById('fittingNote').innerText = note;
        updateProgressBar(3); // å®Œæˆæ­¥é©Ÿ 3
    }

    function finishSession() {
        switchStep('result', 'end-screen');
        updateProgressBar(0); // éš±è—é€²åº¦æ¢
    }

    function showRecommendations() {
        document.getElementById('result').classList.remove('active');
        document.getElementById('promo-sub').classList.remove('active');
        document.getElementById('promo-main').classList.add('active');
        updateProgressBar(0); // é€²å…¥å°è³¼ï¼Œéš±è—é€²åº¦æ¢ä»¥æ¸›å°‘å¹²æ“¾
    }

    function backToResult() {
        switchStep('promo-main', 'result');
        updateProgressBar(3); // è¿”å›çµæœï¼Œé‡æ–°é¡¯ç¤ºé€²åº¦æ¢
    }

    function showSubCategory(type) {
        const container = document.getElementById('subButtonsContainer');
        container.innerHTML = ''; 
        let title = '';
        let items = [];

        if (type === 'shape') {
            title = 'æ‚¨æƒ³ä¿®é£¾çš„èº«å½¢å›°æ“¾æ˜¯ï¼Ÿ';
            items = productLinks.shape;
        } else if (type === 'material') {
            title = 'æ‚¨åå¥½çš„æè³ªæ˜¯ï¼Ÿ';
            items = productLinks.material;
        } else if (type === 'cut') {
            title = 'æ‚¨å–œæ­¡çš„ç‰ˆå‹é«˜åº¦ï¼Ÿ';
            items = productLinks.cut;
        } else if (type === 'habit') {
            title = 'æ‚¨å¸Œæœ›èƒ½è§£æ±ºä»€éº¼å›°æ“¾ï¼Ÿ';
            items = productLinks.habit;
        }

        document.getElementById('subTitle').innerText = title;

        items.forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'outline-btn';
            btn.style.marginBottom = '10px';
            btn.innerText = item.name;
            btn.onclick = function() {
                goToLink(item.url);
            };
            container.appendChild(btn);
        });

        switchStep('promo-main', 'promo-sub');
    }

    function goToLink(url) {
        window.open(url, '_blank');
    }

    function copyResult() {
        const hipInfo = userData.hip ? `${userData.hip}cm` : "æœªæ¸¬é‡";
        const prefText = userData.preference === 'tight' ? 'å–œæ­¡è²¼èº«' : 'å–œæ­¡å¯¬é¬†';
        const textToCopy = `ã€æˆ‘çš„å…§è¤²å°ºå¯¸è³‡è¨Šã€‘\nèº«é«˜ï¼š${userData.height}cm\né«”é‡ï¼š${userData.weight}kg\nè‡€åœï¼š${hipInfo}\nåå¥½ï¼š${prefText}\nğŸ‘‰ ç³»çµ±å»ºè­°å°ºå¯¸ï¼š${userData.finalSize}`;
        
        const tempInput = document.createElement("textarea");
        tempInput.value = textToCopy;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand("copy");
        document.body.removeChild(tempInput);

        const x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
    }
</script>

</body>
</html>
